# A76XX_R3_Series_OpenSDK_Q&A

## 1. 客户从1601、1603等旧平台移植到新架构后，出现大量编译报错问题

- 该问题主要是由于新的编译架构为了避免客户代码中的各种潜在问题，提高了编译等级。
- 在旧的编译框架中，允许客户代码中出现warning，然后这些warning可能引起各种运行时问题，并且很难排查。因此在新的编译框架中，将不允许代码中存在warning。
- 如果客户不希望更改代码，则需要手动降低代码的编译等级。更改方法参考《A76xx_R3_Series_OpenSDK_编译指南_V1.00.03.pdf》中6.2章节中第6）点。

## 2. 编译报close函数重复定义问题

- 该问题主要是由于客户同时include了unistd.h头文件合scfw_socket.h头文件。unistd.h头文件主要是linux环境的头文件，该头文件并没有在我们的SDK中进行适配，客户应该尽可能避免使用该头文件及其函数。

## 3. task的创建删除的注意事项

- task的删除必须要要保证其函数以及跑完并返回，否则无法正常停止并删除。
- task的函数一般都会有一个while(1)来执行特定的循环，在删除task前，必须要退出该循环，使其函数正常结束。

## 4. 客户如何定义task优先级

- task优先级数值越高，其优先级越低。
- 客户task优先级建议定义在150 - 250之间。
- ASR RTOS系列模块采用的使threadX内核，其task支持抢占机制，高优先级task可以抢占低优先级task的CPU。同优先级task不可互相抢占。
- ASR有很多系统task不能长时间被打断，否则会引起死机等严重问题，因此客户task不应设置太高。ASR系统task优先级基本都小于120。
- 若客户APP有被系统task抢占，长时间得不到调度的情况，可以考虑提升优先级。但客户必须对此深思熟虑，熟知对此带来的后果，并有相应的对策来避免系统阻塞带来的问题。同时还需要充足的测试来保证系统的稳定。

## 5. 文件打开关闭注意事项

- 由于文件系统缓存机制的存在，文件的写入可能不会及时的写入flash，由此带来的问题主要是在异常掉电的情况下导致文件数据丢失。对此问题，需要客户使用sAPI_fsync来强制将文件缓存写入flash。
- 读写文件结束后，因及时关闭文件，否则在各种各样的处理中，可能会引起不可预知的文件损坏。文件资源长时间被占用，还可能导致其他应用不能正常获取资源并操作文件系统。

## 6. SDK上传客户git系统后，编译出现问题

- SDK的编译系统采用了makefile，脚本中各个过程具有依赖关系。根据目标和依赖项的时间戳来决定是否执行具体的指令。
- 客户将SDK上传git系统后，git系统会改变文件的时间戳，导致脚本中的依赖关系异常触发。SDK中本不该执行的指令，会因为时间戳的原因而执行，最终导致编译错误。
- 针对此问题，客户必须把makefile中对应的过程删除掉，来避免这个问题。
- 其方法为，先编译SDK解压出来的项目；再将项目上传git，拉取下来再进行编译；对比两次编译的log，找出通过git拉取后的编译中多余的执行过程，在makefile中删除这些多余的执行过程即可。
